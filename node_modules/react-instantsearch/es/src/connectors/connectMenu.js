import _orderBy from'lodash/orderBy';function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}import PropTypes from'prop-types';import createConnector from'../core/createConnector';import{getIndex,cleanUpValue,refineValue,getCurrentRefinementValue,getResults}from'../core/indexUtils';var namespace='menu';function getId(a){return a.attributeName}function getCurrentRefinement(a,b,c){return getCurrentRefinementValue(a,b,c,namespace+'.'+getId(a),null,function(d){return''===d?null:d})}function getValue(a,b,c,d){var e=getCurrentRefinement(b,c,d);return a===e?'':a}function _refine(a,b,c,d){var e=getId(a),f=_defineProperty({},e,c?c:'');return refineValue(b,f,d,!0,namespace)}function _cleanUp(a,b,c){return cleanUpValue(b,c,namespace+'.'+getId(a))}var sortBy=['count:desc','name:asc'];export default createConnector({displayName:'AlgoliaMenu',propTypes:{attributeName:PropTypes.string.isRequired,showMore:PropTypes.bool,limitMin:PropTypes.number,limitMax:PropTypes.number,defaultRefinement:PropTypes.string,transformItems:PropTypes.func,withSearchBox:PropTypes.bool,searchForFacetValues:PropTypes.bool},defaultProps:{showMore:!1,limitMin:10,limitMax:20},getProvidedProps:function getProvidedProps(a,b,c,d,e){var f=this,g=a.attributeName,h=a.showMore,i=a.limitMin,j=a.limitMax,k=h?j:i,l=getResults(c,this.context),m=!!l&&!!l.getFacetByName(g),n=!!(e&&e[g]&&''!==e.query),o=a.withSearchBox||a.searchForFacetValues;if('development'===process.env.NODE_ENV&&a.searchForFacetValues&&console.warn('react-instantsearch: `searchForFacetValues` has been renamed to`withSearchBox`, this will break in the next major version.'),a.withSearchBox&&this.context.multiIndexContext)throw new Error('react-instantsearch: searching in *List is not available when used inside a multi index context');if(!m)return{items:[],currentRefinement:getCurrentRefinement(a,b,this.context),isFromSearch:n,withSearchBox:o,canRefine:m};var p=n?e[g].map(function(s){return{label:s.value,value:getValue(s.value,a,b,f.context),_highlightResult:{label:{value:s.highlighted}},count:s.count,isRefined:s.isRefined}}):l.getFacetValues(g,{sortBy:sortBy}).map(function(s){return{label:s.name,value:getValue(s.name,a,b,f.context),count:s.count,isRefined:s.isRefined}}),q=o&&!n?_orderBy(p,['isRefined','count','label'],['desc','desc','asc']):p,r=a.transformItems?a.transformItems(q):q;return{items:r.slice(0,k),currentRefinement:getCurrentRefinement(a,b,this.context),isFromSearch:n,withSearchBox:o,canRefine:0<p.length}},refine:function refine(a,b,c){return _refine(a,b,c,this.context)},searchForFacetValues:function searchForFacetValues(a,b,c){return{facetName:a.attributeName,query:c}},cleanUp:function cleanUp(a,b){return _cleanUp(a,b,this.context)},getSearchParameters:function getSearchParameters(a,b,c){var d=b.attributeName,e=b.showMore,f=b.limitMin,g=b.limitMax,h=e?g:f;a=a.setQueryParameters({maxValuesPerFacet:Math.max(a.maxValuesPerFacet||0,h)}),a=a.addDisjunctiveFacet(d);var i=getCurrentRefinement(b,c,this.context);return null!==i&&(a=a.addDisjunctiveFacetRefinement(d,i)),a},getMetadata:function getMetadata(a,b){var c=this,d=getId(a),e=getCurrentRefinement(a,b,this.context);return{id:d,index:getIndex(this.context),items:null===e?[]:[{label:a.attributeName+': '+e,attributeName:a.attributeName,value:function value(f){return _refine(a,f,'',c.context)},currentRefinement:e}]}}});
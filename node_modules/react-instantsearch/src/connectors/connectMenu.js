'use strict';var _orderBy2=require('lodash/orderBy'),_orderBy3=_interopRequireDefault(_orderBy2),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_createConnector=require('../core/createConnector'),_createConnector2=_interopRequireDefault(_createConnector),_indexUtils=require('../core/indexUtils');Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var namespace='menu';function getId(a){return a.attributeName}function getCurrentRefinement(a,b,c){return(0,_indexUtils.getCurrentRefinementValue)(a,b,c,namespace+'.'+getId(a),null,function(d){return''===d?null:d})}function getValue(a,b,c,d){var e=getCurrentRefinement(b,c,d);return a===e?'':a}function _refine(a,b,c,d){var e=getId(a),f=_defineProperty({},e,c?c:'');return(0,_indexUtils.refineValue)(b,f,d,!0,namespace)}function _cleanUp(a,b,c){return(0,_indexUtils.cleanUpValue)(b,c,namespace+'.'+getId(a))}var sortBy=['count:desc','name:asc'];exports.default=(0,_createConnector2.default)({displayName:'AlgoliaMenu',propTypes:{attributeName:_propTypes2.default.string.isRequired,showMore:_propTypes2.default.bool,limitMin:_propTypes2.default.number,limitMax:_propTypes2.default.number,defaultRefinement:_propTypes2.default.string,transformItems:_propTypes2.default.func,withSearchBox:_propTypes2.default.bool,searchForFacetValues:_propTypes2.default.bool},defaultProps:{showMore:!1,limitMin:10,limitMax:20},getProvidedProps:function getProvidedProps(a,b,c,d,e){var f=this,g=a.attributeName,h=a.showMore,i=a.limitMin,j=a.limitMax,k=h?j:i,l=(0,_indexUtils.getResults)(c,this.context),m=!!l&&!!l.getFacetByName(g),n=!!(e&&e[g]&&''!==e.query),o=a.withSearchBox||a.searchForFacetValues;if('development'===process.env.NODE_ENV&&a.searchForFacetValues&&console.warn('react-instantsearch: `searchForFacetValues` has been renamed to`withSearchBox`, this will break in the next major version.'),a.withSearchBox&&this.context.multiIndexContext)throw new Error('react-instantsearch: searching in *List is not available when used inside a multi index context');if(!m)return{items:[],currentRefinement:getCurrentRefinement(a,b,this.context),isFromSearch:n,withSearchBox:o,canRefine:m};var p=n?e[g].map(function(s){return{label:s.value,value:getValue(s.value,a,b,f.context),_highlightResult:{label:{value:s.highlighted}},count:s.count,isRefined:s.isRefined}}):l.getFacetValues(g,{sortBy:sortBy}).map(function(s){return{label:s.name,value:getValue(s.name,a,b,f.context),count:s.count,isRefined:s.isRefined}}),q=o&&!n?(0,_orderBy3.default)(p,['isRefined','count','label'],['desc','desc','asc']):p,r=a.transformItems?a.transformItems(q):q;return{items:r.slice(0,k),currentRefinement:getCurrentRefinement(a,b,this.context),isFromSearch:n,withSearchBox:o,canRefine:0<p.length}},refine:function refine(a,b,c){return _refine(a,b,c,this.context)},searchForFacetValues:function searchForFacetValues(a,b,c){return{facetName:a.attributeName,query:c}},cleanUp:function cleanUp(a,b){return _cleanUp(a,b,this.context)},getSearchParameters:function getSearchParameters(a,b,c){var d=b.attributeName,e=b.showMore,f=b.limitMin,g=b.limitMax,h=e?g:f;a=a.setQueryParameters({maxValuesPerFacet:Math.max(a.maxValuesPerFacet||0,h)}),a=a.addDisjunctiveFacet(d);var i=getCurrentRefinement(b,c,this.context);return null!==i&&(a=a.addDisjunctiveFacetRefinement(d,i)),a},getMetadata:function getMetadata(a,b){var c=this,d=getId(a),e=getCurrentRefinement(a,b,this.context);return{id:d,index:(0,_indexUtils.getIndex)(this.context),items:null===e?[]:[{label:a.attributeName+': '+e,attributeName:a.attributeName,value:function value(f){return _refine(a,f,'',c.context)},currentRefinement:e}]}}});
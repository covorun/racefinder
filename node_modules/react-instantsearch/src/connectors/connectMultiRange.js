'use strict';var _isEmpty2=require('lodash/isEmpty'),_isEmpty3=_interopRequireDefault(_isEmpty2),_find3=require('lodash/find'),_find4=_interopRequireDefault(_find3),_slicedToArray=function(){function a(b,c){var d=[],e=!0,f=!1,g=void 0;try{for(var j,h=b[Symbol.iterator]();!(e=(j=h.next()).done)&&(d.push(j.value),!(c&&d.length===c));e=!0);}catch(k){f=!0,g=k}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw g}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_indexUtils=require('../core/indexUtils'),_createConnector=require('../core/createConnector'),_createConnector2=_interopRequireDefault(_createConnector);Object.defineProperty(exports,'__esModule',{value:!0});function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function stringifyItem(a){return'undefined'==typeof a.start&&'undefined'==typeof a.end?'':(a.start?a.start:'')+':'+(a.end?a.end:'')}function parseItem(a){if(0===a.length)return{start:null,end:null};var b=a.split(':'),c=_slicedToArray(b,2),d=c[0],e=c[1];return{start:0<d.length?parseInt(d,10):null,end:0<e.length?parseInt(e,10):null}}var namespace='multiRange';function getId(a){return a.attributeName}function getCurrentRefinement(a,b,c){return(0,_indexUtils.getCurrentRefinementValue)(a,b,c,namespace+'.'+getId(a),'',function(d){return''===d?'':d})}function isRefinementsRangeIncludesInsideItemRange(a,b,c){return a.min>b&&a.min<c||a.max>b&&a.max<c}function isItemRangeIncludedInsideRefinementsRange(a,b,c){return b>a.min&&b<a.max||c>a.min&&c<a.max}function itemHasRefinement(a,b,c){var d=b.getFacetByName(a)?b.getFacetStats(a):null,e=c.split(':'),f=0===+e[0]||''===c?Number.NEGATIVE_INFINITY:+e[0],g=0===+e[1]||''===c?Number.POSITIVE_INFINITY:+e[1];return!(!!d&&(isRefinementsRangeIncludesInsideItemRange(d,f,g)||isItemRangeIncludedInsideRefinementsRange(d,f,g)))}function _refine(a,b,c,d){var e=_defineProperty({},getId(a,b),c);return(0,_indexUtils.refineValue)(b,e,d,!0,namespace)}function _cleanUp(a,b,c){return(0,_indexUtils.cleanUpValue)(b,c,namespace+'.'+getId(a))}exports.default=(0,_createConnector2.default)({displayName:'AlgoliaMultiRange',propTypes:{id:_propTypes2.default.string,attributeName:_propTypes2.default.string.isRequired,items:_propTypes2.default.arrayOf(_propTypes2.default.shape({label:_propTypes2.default.node,start:_propTypes2.default.number,end:_propTypes2.default.number})).isRequired,transformItems:_propTypes2.default.func},getProvidedProps:function getProvidedProps(a,b,c){var d=a.attributeName,e=getCurrentRefinement(a,b,this.context),f=(0,_indexUtils.getResults)(c,this.context),g=a.items.map(function(k){var l=stringifyItem(k);return{label:k.label,value:l,isRefined:l===e,noRefinement:!!f&&itemHasRefinement(getId(a),f,l)}}),h=f&&f.getFacetByName(d)?f.getFacetStats(d):null,j=(0,_find4.default)(g,function(k){return!0===k.isRefined});return g.some(function(k){return''===k.value})||g.push({value:'',isRefined:(0,_isEmpty3.default)(j),noRefinement:!h,label:'All'}),{items:a.transformItems?a.transformItems(g):g,currentRefinement:e,canRefine:0<g.length&&g.some(function(k){return!1===k.noRefinement})}},refine:function refine(a,b,c){return _refine(a,b,c,this.context)},cleanUp:function cleanUp(a,b){return _cleanUp(a,b,this.context)},getSearchParameters:function getSearchParameters(a,b,c){var d=b.attributeName,e=parseItem(getCurrentRefinement(b,c,this.context)),f=e.start,g=e.end;return a=a.addDisjunctiveFacet(d),f&&(a=a.addNumericRefinement(d,'>=',f)),g&&(a=a.addNumericRefinement(d,'<=',g)),a},getMetadata:function getMetadata(a,b){var c=this,d=getId(a),e=getCurrentRefinement(a,b,this.context),f=[],g=(0,_indexUtils.getIndex)(this.context);if(''!==e){var h=(0,_find4.default)(a.items,function(k){return stringifyItem(k)===e}),j=h.label;f.push({label:a.attributeName+': '+j,attributeName:a.attributeName,currentRefinement:j,value:function value(k){return _refine(a,k,'',c.context)}})}return{id:d,index:g,items:f}}});
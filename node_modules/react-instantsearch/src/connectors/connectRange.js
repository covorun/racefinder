'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_indexUtils=require('../core/indexUtils'),_createConnector=require('../core/createConnector'),_createConnector2=_interopRequireDefault(_createConnector);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function getId(a){return a.attributeName}var namespace='range';function getCurrentRefinement(a,b,c){return(0,_indexUtils.getCurrentRefinementValue)(a,b,c,namespace+'.'+getId(a),{},function(d){var e=d.min,f=d.max;return'string'==typeof e&&(e=parseInt(e,10)),'string'==typeof f&&(f=parseInt(f,10)),{min:e,max:f}})}function _refine(a,b,c,d){if(!isFinite(c.min)||!isFinite(c.max))throw new Error('You can\'t provide non finite values to the range connector');var e=getId(a),f=_defineProperty({},e,c);return(0,_indexUtils.refineValue)(b,f,d,!0,namespace)}function _cleanUp(a,b,c){return(0,_indexUtils.cleanUpValue)(b,c,namespace+'.'+getId(a))}exports.default=(0,_createConnector2.default)({displayName:'AlgoliaRange',propTypes:{id:_propTypes2.default.string,attributeName:_propTypes2.default.string.isRequired,defaultRefinement:_propTypes2.default.shape({min:_propTypes2.default.number.isRequired,max:_propTypes2.default.number.isRequired}),min:_propTypes2.default.number,max:_propTypes2.default.number},getProvidedProps:function getProvidedProps(a,b,c){var d=a.attributeName,e=a.min,f=a.max,g='undefined'!=typeof e,h='undefined'!=typeof f,i=(0,_indexUtils.getResults)(c,this.context);if(!g||!h){if(!i)return{canRefine:!1};var p=i.getFacetByName(d)?i.getFacetStats(d):null;if(!p)return{canRefine:!1};g||(e=p.min),h||(f=p.max)}var j=i?i.getFacetValues(d).map(function(p){return{value:p.name,count:p.count}}):[],k=getCurrentRefinement(a,b,this.context),l=k.min,m=l===void 0?e:l,n=k.max,o=n===void 0?f:n;return{min:e,max:f,currentRefinement:{min:m,max:o},count:j,canRefine:0<j.length}},refine:function refine(a,b,c){return _refine(a,b,c,this.context)},cleanUp:function cleanUp(a,b){return _cleanUp(a,b,this.context)},getSearchParameters:function getSearchParameters(a,b,c){var d=b.attributeName,e=getCurrentRefinement(b,c,this.context);a=a.addDisjunctiveFacet(d);var f=e.min,g=e.max;return'undefined'!=typeof f&&(a=a.addNumericRefinement(d,'>=',f)),'undefined'!=typeof g&&(a=a.addNumericRefinement(d,'<=',g)),a},getMetadata:function getMetadata(a,b){var c=this,d=getId(a),e=getCurrentRefinement(a,b,this.context),f=void 0,g='undefined'!=typeof e.min,h='undefined'!=typeof e.max;if(g||h){var i='';g&&(i+=e.min+' <= '),i+=a.attributeName,h&&(i+=' <= '+e.max),f={label:i,currentRefinement:e,attributeName:a.attributeName,value:function value(j){return _cleanUp(a,j,c.context)}}}return{id:d,index:(0,_indexUtils.getIndex)(this.context),items:f?[f]:[]}}});
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.getId=void 0;var _propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_createConnector=require('../core/createConnector'),_createConnector2=_interopRequireDefault(_createConnector),_algoliasearchHelper=require('algoliasearch-helper'),_indexUtils=require('../core/indexUtils');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var getId=exports.getId=function(a){return a.attributes[0]},namespace='hierarchicalMenu';function getCurrentRefinement(a,b,c){return(0,_indexUtils.getCurrentRefinementValue)(a,b,c,namespace+'.'+getId(a),null,function(d){return''===d?null:d})}function getValue(a,b,c,d){var e=b.id,f=b.attributes,g=b.separator,h=b.rootPath,i=b.showParentLevel,j=getCurrentRefinement(b,c,d),k=void 0;if(null===j)k=a;else{var l=new _algoliasearchHelper.SearchParameters({hierarchicalFacets:[{name:e,attributes:f,separator:g,rootPath:h,showParentLevel:i}]});k=l.toggleHierarchicalFacetRefinement(e,j).toggleHierarchicalFacetRefinement(e,a).getHierarchicalRefinement(e)[0]}return k}function transformValue(a,b,c,d,e){return a.slice(0,b).map(function(f){return{label:f.name,value:getValue(f.path,c,d,e),count:f.count,isRefined:f.isRefined,items:f.data&&transformValue(f.data,b,c,d,e)}})}function _refine(a,b,c,d){var e=getId(a),f=_defineProperty({},e,c||'');return(0,_indexUtils.refineValue)(b,f,d,!0,namespace)}function _cleanUp(a,b,c){return(0,_indexUtils.cleanUpValue)(b,c,namespace+'.'+getId(a))}var sortBy=['name:asc'];exports.default=(0,_createConnector2.default)({displayName:'AlgoliaHierarchicalMenu',propTypes:{attributes:function attributes(a,b,c){return!Array.isArray(a[b])||a[b].some(function isNotString(e){return'string'!=typeof e})||1>a[b].length?new Error('Invalid prop '+b+' supplied to '+c+'. Expected an Array of Strings'):void 0},separator:_propTypes2.default.string,rootPath:_propTypes2.default.string,showParentLevel:_propTypes2.default.bool,defaultRefinement:_propTypes2.default.string,showMore:_propTypes2.default.bool,limitMin:_propTypes2.default.number,limitMax:_propTypes2.default.number,transformItems:_propTypes2.default.func},defaultProps:{showMore:!1,limitMin:10,limitMax:20,separator:' > ',rootPath:null,showParentLevel:!0},getProvidedProps:function getProvidedProps(a,b,c){var d=a.showMore,e=a.limitMin,f=a.limitMax,g=getId(a),h=(0,_indexUtils.getResults)(c,this.context),i=!!h&&!!h.getFacetByName(g);if(!i)return{items:[],currentRefinement:getCurrentRefinement(a,b,this.context),canRefine:!1};var j=d?f:e,k=h.getFacetValues(g,{sortBy:sortBy}),l=k.data?transformValue(k.data,j,a,b,this.context):[];return{items:a.transformItems?a.transformItems(l):l,currentRefinement:getCurrentRefinement(a,b,this.context),canRefine:0<l.length}},refine:function refine(a,b,c){return _refine(a,b,c,this.context)},cleanUp:function cleanUp(a,b){return _cleanUp(a,b,this.context)},getSearchParameters:function getSearchParameters(a,b,c){var d=b.attributes,e=b.separator,f=b.rootPath,g=b.showParentLevel,h=b.showMore,i=b.limitMin,j=b.limitMax,k=getId(b),l=h?j:i;a=a.addHierarchicalFacet({name:k,attributes:d,separator:e,rootPath:f,showParentLevel:g}).setQueryParameters({maxValuesPerFacet:Math.max(a.maxValuesPerFacet||0,l)});var m=getCurrentRefinement(b,c,this.context);return null!==m&&(a=a.toggleHierarchicalFacetRefinement(k,m)),a},getMetadata:function getMetadata(a,b){var c=this,d=a.attributes[0],e=getId(a),f=getCurrentRefinement(a,b,this.context);return{id:e,index:(0,_indexUtils.getIndex)(this.context),items:f?[{label:d+': '+f,attributeName:d,value:function value(g){return _refine(a,g,'',c.context)},currentRefinement:f}]:[]}}});
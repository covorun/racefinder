'use strict';var _isEqual2=require('lodash/isEqual'),_isEqual3=_interopRequireDefault(_isEqual2),_has2=require('lodash/has'),_has3=_interopRequireDefault(_has2),_extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});exports.default=createConnector;var _propTypes=require('prop-types'),_propTypes2=_interopRequireDefault(_propTypes),_react=require('react'),_react2=_interopRequireDefault(_react),_utils=require('./utils');function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function createConnector(a){if(!a.displayName)throw new Error('`createConnector` requires you to provide a `displayName` property.');var b=(0,_has3.default)(a,'refine'),c=(0,_has3.default)(a,'searchForFacetValues'),d=(0,_has3.default)(a,'getSearchParameters'),e=(0,_has3.default)(a,'getMetadata'),f=(0,_has3.default)(a,'transitionState'),g=(0,_has3.default)(a,'cleanUp'),h=d||e||f;return function(j){var k,l,m;return l=k=function(n){function o(p,q){_classCallCheck(this,o);var r=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,p,q));m.call(r);var s=q.ais,t=s.store,u=s.widgetsManager,v=q.multiIndexContext;r.state={props:r.getProvidedProps(p)},r.unsubscribe=t.subscribe(function(){r.setState({props:r.getProvidedProps(r.props)})});var w=d?function(z){return a.getSearchParameters.call(r,z,r.props,t.getState().widgets)}:null,x=e?function(z){return a.getMetadata.call(r,r.props,z)}:null,y=f?function(z,A){return a.transitionState.call(r,r.props,z,A)}:null;return h&&(r.unregisterWidget=u.registerWidget({getSearchParameters:w,getMetadata:x,transitionState:y,multiIndexContext:v})),r}return _inherits(o,n),_createClass(o,[{key:'componentWillReceiveProps',value:function componentWillReceiveProps(p){(0,_isEqual3.default)(this.props,p)||(this.setState({props:this.getProvidedProps(p)}),h&&(this.context.ais.widgetsManager.update(),a.transitionState&&this.context.ais.onSearchStateChange(a.transitionState.call(this,p,this.context.ais.store.getState().widgets,this.context.ais.store.getState().widgets))))}},{key:'componentWillUnmount',value:function componentWillUnmount(){if(this.unsubscribe(),h&&(this.unregisterWidget(),g)){var p=a.cleanUp.call(this,this.props,this.context.ais.store.getState().widgets);this.context.ais.store.setState(_extends({},this.context.ais.store.getState(),{widgets:p})),this.context.ais.onSearchStateChange((0,_utils.removeEmptyKey)(p))}}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(p,q){var r=(0,_utils.shallowEqual)(this.props,p);return null===this.state.props||null===q.props?this.state.props!==q.props||!r:!r||!(0,_utils.shallowEqual)(this.state.props,q.props)}},{key:'render',value:function render(){var p=this;if(null===this.state.props)return null;var q=b?{refine:this.refine,createURL:this.createURL}:{},r=c?{searchForItems:this.searchForFacetValues,searchForFacetValues:function searchForFacetValues(s,t){'development'===process.env.NODE_ENV&&console.warn('react-instantsearch: `searchForFacetValues` has been renamed to`searchForItems`, this will break in the next major version.'),p.searchForFacetValues(s,t)}}:{};return _react2.default.createElement(j,_extends({},this.props,this.state.props,q,r))}}]),o}(_react.Component),k.displayName=a.displayName+'('+(0,_utils.getDisplayName)(j)+')',k.defaultClassNames=j.defaultClassNames,k.propTypes=a.propTypes,k.defaultProps=a.defaultProps,k.contextTypes={ais:_propTypes2.default.object.isRequired,multiIndexContext:_propTypes2.default.object},m=function _initialiseProps(){var n=this;this.getProvidedProps=function(o){var p=n.context.ais.store,q=p.getState(),r=q.results,s=q.searching,t=q.error,u=q.widgets,v=q.metadata,w=q.resultsFacetValues,x=q.searchingForFacetValues;return a.getProvidedProps.call(n,o,u,{results:r,searching:s,error:t,searchingForFacetValues:x},v,w)},this.refine=function(){for(var o,p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];n.context.ais.onInternalStateUpdate((o=a.refine).call.apply(o,[n,n.props,n.context.ais.store.getState().widgets].concat(q)))},this.searchForFacetValues=function(){for(var o=arguments.length,p=Array(o),q=0;q<o;q++)p[q]=arguments[q];n.context.ais.onSearchForFacetValues(a.searchForFacetValues.apply(a,[n.props,n.context.ais.store.getState().widgets].concat(p)))},this.createURL=function(){for(var o,p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return n.context.ais.createHrefForState((o=a.refine).call.apply(o,[n,n.props,n.context.ais.store.getState().widgets].concat(q)))},this.cleanUp=function(){for(var o,p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return(o=a.cleanUp).call.apply(o,[n].concat(q))}},l}}